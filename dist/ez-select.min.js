"use strict";angular.module("ez.select",["ez.object2array"]).constant("ezSelectConfig",{textField:"text",idField:"id"}).directive("ezSelect",["ezSelectConfig","$document","object2arrayFilter","filterFilter","orderByFilter",function(ezSelectConfig,$document){return{restrict:"EA",replace:!0,scope:{options:"=options",selectedId:"=selectedId",selectedIds:"=selectedIds",selectedOption:"=selectedOption",selectedOptions:"=selectedOptions",search:"=search"},templateUrl:"ez-select.tpl.html",compile:function(element){var $toggle=element.find(".ez-select-toggle"),fontSize=parseFloat($toggle.css("font-size"),10),maxChars=$toggle.width()/(.5*fontSize),closeDropdown=function(e){$(e.target).is("input")||($document.unbind("click",closeDropdown),element.removeClass("open"))};return function(scope,element,attrs){scope._options={},console.log(attrs.hasOwnProperty("selectedId")),"function"==typeof scope.search?(scope.ajaxSearch=!0,scope.showSearch=!0):scope.showSearch=!!scope.search,scope.open=function(e){e.preventDefault(),e.stopPropagation(),element.addClass("open"),element.find(".search-box input").trigger("focus"),$document.click(closeDropdown)},scope.select=function(e,option){e.preventDefault(),e.stopPropagation(),scope.multiple?option._selected?(option._selected=null,scope.selectedIds.splice(scope.selectedIds.indexOf(option.id),1)):(option._selected=!0,scope.selectedIds.push(option.id)):(scope.selected=option.id,closeDropdown(e)),scope.updateText()},scope.updateText=function(){var str="";if(scope.selected)if(scope.multiple){if(scope.selected.length){for(var s in scope.selected)str+=scope.options[s].text+", ";str=str.slice(0,-2)}}else str=scope._options[scope.selected].text;str?str.length>maxChars&&(str=scope.multiple?scope.selected.length+" selected":"1 selected"):str="Select an option",scope.selectedText=str},scope.filter=function(){},scope.$watch("form.query",function(newVal,oldVal){if(scope.searchEnabled)if(newVal&&newVal.length>0&&newVal!==oldVal)scope._options={},scope.search(newVal).then(function(res){scope._options=res.data});else for(var k in scope.options)scope._options[scope.options[k].id]=scope.options[k];else scope.filter(newVal)}),scope.$watch("options",function(){scope.updateText()}),scope.$watchCollection("selected",function(){})}}}}]);